<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Sample a synthetic genome from a trained Markov model — gsynth.sample • misha</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Sample a synthetic genome from a trained Markov model — gsynth.sample"><meta property="og:description" content="Generates a synthetic genome by sampling from a trained stratified Markov-5
model. The generated genome preserves the k-mer statistics of the original
genome within each stratification bin."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">misha</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">5.4.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Database-Formats.html">Database Formats and Multi-Contig Support</a>
    </li>
    <li>
      <a href="../articles/Genomes.html">Genomes</a>
    </li>
    <li>
      <a href="../articles/Manual.html">Manual</a>
    </li>
    <li>
      <a href="../articles/Misha-Basics.html">Misha Basics (Short Guide)</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/tanaylab/misha/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Sample a synthetic genome from a trained Markov model</h1>
    <small class="dont-index">Source: <a href="https://github.com/tanaylab/misha/blob/master/R/synth.R" class="external-link"><code>R/synth.R</code></a></small>
    <div class="hidden name"><code>gsynth.sample.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Generates a synthetic genome by sampling from a trained stratified Markov-5
model. The generated genome preserves the k-mer statistics of the original
genome within each stratification bin.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gsynth.sample</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  output_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"misha"</span>, <span class="st">"fasta"</span>, <span class="st">"vector"</span><span class="op">)</span>,</span>
<span>  mask_copy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  intervals <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_samples <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  bin_merge <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A gsynth.model object from <code><a href="gsynth.train.html">gsynth.train</a></code></p></dd>


<dt id="arg-output-path">output_path<a class="anchor" aria-label="anchor" href="#arg-output-path"></a></dt>
<dd><p>Path to the output file (ignored when output_format = "vector")</p></dd>


<dt id="arg-output-format">output_format<a class="anchor" aria-label="anchor" href="#arg-output-format"></a></dt>
<dd><p>Output format:</p><ul><li><p>"misha": .seq binary format (default)</p></li>
<li><p>"fasta": FASTA text format</p></li>
<li><p>"vector": Return sequences as a character vector (does not write to file)</p></li>
</ul></dd>


<dt id="arg-mask-copy">mask_copy<a class="anchor" aria-label="anchor" href="#arg-mask-copy"></a></dt>
<dd><p>Optional intervals to copy from the original genome instead of
sampling. Use this to preserve specific regions (e.g., repeats, regulatory
elements) exactly as they appear in the reference. Regions not in mask_copy
will be sampled using the Markov model.
Note: mask_copy intervals should be non-overlapping and sorted by start
position within each chromosome. Overlapping intervals may result in
only the first overlapping region being copied, with subsequent overlaps
skipped due to cursor advancement during sequential processing.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Random seed for reproducibility. If NULL, uses current random state.</p></dd>


<dt id="arg-intervals">intervals<a class="anchor" aria-label="anchor" href="#arg-intervals"></a></dt>
<dd><p>Genomic intervals to sample. If NULL, uses all chromosomes.</p></dd>


<dt id="arg-n-samples">n_samples<a class="anchor" aria-label="anchor" href="#arg-n-samples"></a></dt>
<dd><p>Number of samples to generate per interval. Default is 1.
When n_samples &gt; 1 and output_format = "fasta", headers include "_sampleN".
When output_format = "vector", returns n_samples * n_intervals sequences.</p></dd>


<dt id="arg-bin-merge">bin_merge<a class="anchor" aria-label="anchor" href="#arg-bin-merge"></a></dt>
<dd><p>Optional list of bin merge specifications to apply during sampling,
       one per dimension (length must equal model$n_dims). Each element should be:</p><ul><li><p>A list of merge specifications (same format as in
               <code><a href="gsynth.train.html">gsynth.train</a></code>: each spec is <code>list(from = ..., to = ...)</code>)</p></li>
<li><p>Or NULL to use the bin mapping from training for that dimension</p></li>
</ul><p>This allows merging sparse bins at sampling time without re-training.
       Example for a 2D model:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">bin_merge</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># Dimension 1: merge bins with values &gt;= 0.8 to bin [0.7, 0.8)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="cn">Inf</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co"># Dimension 2: use training-time bin_map (no override)</span></span>
<span>  <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span>       </span></code></pre></div></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>When output_format is "misha" or "fasta", returns invisible NULL and
        writes the synthetic genome to output_path. When output_format is "vector",
        returns a character vector of sequences (length = n_intervals * n_samples).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><strong>N bases during sampling:</strong> When the sampler needs to initialize the
first 5-mer context and encounters regions with only N bases, it falls back
to uniform random base selection until a valid context is established.
Similarly, if a bin has no learned statistics (sparse bin with NA CDF),
uniform sampling is used for that position.</p>
<p><strong>Sparse bins:</strong> If the model has sparse bins (from <code>min_obs</code> during
training), a warning is issued when sampling regions that fall into these bins.
Consider using <code>bin_merge</code> to redirect sparse bins to well-populated ones.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="gsynth.train.html">gsynth.train</a></code>, <code><a href="gsynth.save.html">gsynth.save</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="gdb.init.html">gdb.init_examples</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create virtual tracks</span></span></span>
<span class="r-in"><span><span class="fu"><a href="gvtrack.create.html">gvtrack.create</a></span><span class="op">(</span><span class="st">"g_frac"</span>, <span class="cn">NULL</span>, <span class="st">"kmer.frac"</span>, kmer <span class="op">=</span> <span class="st">"G"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="gvtrack.create.html">gvtrack.create</a></span><span class="op">(</span><span class="st">"c_frac"</span>, <span class="cn">NULL</span>, <span class="st">"kmer.frac"</span>, kmer <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="gvtrack.create.html">gvtrack.create</a></span><span class="op">(</span><span class="st">"cg_frac"</span>, <span class="cn">NULL</span>, <span class="st">"kmer.frac"</span>, kmer <span class="op">=</span> <span class="st">"CG"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>kmer sequence 'CG' is palindromic, please set strand to 1 or -1 to avoid double counting</span>
<span class="r-in"><span><span class="fu"><a href="gvtrack.create.html">gvtrack.create</a></span><span class="op">(</span><span class="st">"masked_frac"</span>, <span class="cn">NULL</span>, <span class="st">"masked.frac"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define repeat mask (regions to preserve from original)</span></span></span>
<span class="r-in"><span><span class="va">repeats</span> <span class="op">&lt;-</span> <span class="fu"><a href="gscreen.html">gscreen</a></span><span class="op">(</span><span class="st">"masked_frac &gt; 0.5"</span>,</span></span>
<span class="r-in"><span>    intervals <span class="op">=</span> <span class="fu"><a href="gintervals.all.html">gintervals.all</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    iterator <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Train model (excluding repeats from training)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="gsynth.train.html">gsynth.train</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>expr <span class="op">=</span> <span class="st">"g_frac + c_frac"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.025</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>expr <span class="op">=</span> <span class="st">"cg_frac"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    mask <span class="op">=</span> <span class="va">repeats</span>,</span></span>
<span class="r-in"><span>    iterator <span class="op">=</span> <span class="fl">200</span>,</span></span>
<span class="r-in"><span>    min_obs <span class="op">=</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Extracting track values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Training Markov model...</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>124 out of 200 bins have fewer than 1000 observations and are marked as NA.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Use bin_merge to merge sparse bins before sampling, or they will use uniform sampling.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Trained model: 835,310 6-mers across 200 bins (2 dimensions)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Note: 124 bins have &lt; 1000 observations (marked as NA)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sample with mask_copy to preserve repeats from original genome</span></span></span>
<span class="r-in"><span><span class="va">temp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">synthetic_genome_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"synthetic_genome.fa"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">gsynth.sample</span><span class="op">(</span><span class="va">model</span>, <span class="va">synthetic_genome_file</span>,</span></span>
<span class="r-in"><span>    output_format <span class="op">=</span> <span class="st">"fasta"</span>,</span></span>
<span class="r-in"><span>    mask_copy <span class="op">=</span> <span class="va">repeats</span>,</span></span>
<span class="r-in"><span>    seed <span class="op">=</span> <span class="fl">60427</span>,</span></span>
<span class="r-in"><span>    bin_merge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.7</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.675</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.04</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.04</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Extracting track values for sampling...</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>16 sparse bins (with &lt; 1000 observations) will be used during sampling.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> These bins will use uniform base distribution. Consider using bin_merge to merge them.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Sampling synthetic genome...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Synthetic genome written to: /tmp/RtmpZaF5H8/synthetic_genome.fa</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Misha Hoichman, Aviezer Lifshitz, Eitan Yaffe, Amos Tanay.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

