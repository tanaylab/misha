% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/canvas.R
\name{gcanvas.train}
\alias{gcanvas.train}
\title{Train a stratified Markov-5 model from genome sequences}
\usage{
gcanvas.train(
  expr,
  breaks,
  bin_merge = NULL,
  mask = NULL,
  intervals = NULL,
  iterator = NULL,
  pseudocount = 1
)
}
\arguments{
\item{expr}{Track expression for stratification (e.g., a GC virtual track)}

\item{breaks}{Numeric vector of bin boundaries. For example, \code{seq(0, 1, 0.025)}
creates 40 bins of 2.5\% width.}

\item{bin_merge}{Optional list of merge specifications for merging sparse bins.
     Each specification is a named list with:
\describe{
  \item{from}{Numeric vector of length 2 \code{c(min, max)} defining the
        source value range to merge. Use \code{-Inf} or \code{Inf} for
        open-ended ranges. Can also be a single number (shorthand for
        \code{c(value, Inf)}).}
  \item{to}{Numeric vector of length 2 \code{c(min, max)} defining the
        target bin that source bins should map to. Must exactly match a bin
        defined by \code{breaks}.}
}
     For example, to map all GC content above 70\% to the (0.675, 0.7] bin:
     \code{bin_merge = list(list(from = 0.7, to = c(0.675, 0.7)))}}

\item{mask}{Optional intervals to exclude from training. Regions in the mask
will not contribute to k-mer counts. Can be computed using \code{gscreen()}.}

\item{intervals}{Genomic intervals to process. If NULL, uses all chromosomes.}

\item{iterator}{Iterator for track evaluation, determines the resolution at which
track values are computed.}

\item{pseudocount}{Pseudocount added to all k-mer counts to avoid zero probabilities.
Default is 1.}
}
\value{
A \code{gcanvas.model} object containing:
  \describe{
    \item{num_bins}{Number of stratification bins}
    \item{breaks}{Bin boundaries}
    \item{total_kmers}{Total number of valid 6-mers counted}
    \item{per_bin_kmers}{Number of 6-mers counted per bin}
    \item{total_masked}{Number of positions skipped due to mask}
    \item{total_n}{Number of positions skipped due to N bases}
    \item{model_data}{Internal model data (counts and CDFs)}
  }
}
\description{
Computes a 5th-order Markov model stratified by bins of a track expression
(e.g., GC content). This model can be used to generate synthetic genomes
that preserve the k-mer statistics of the original genome within each bin.
}
\examples{
gdb.init_examples()

# Create GC virtual track at 200bp resolution
gvtrack.create("g_frac", NULL, "kmer.frac", kmer = "G")
gvtrack.create("c_frac", NULL, "kmer.frac", kmer = "C")
gvtrack.create("masked_frac", NULL, "masked.frac")

# Define repeat mask
repeats <- gscreen("masked_frac > 0.5",
    intervals = gintervals.all(),
    iterator = 100
)

# Train model with GC stratification
model <- gcanvas.train(
    expr = "g_frac + c_frac",
    breaks = seq(0, 1, 0.025),
    bin_merge = list(
        list(from = 0.7, to = c(0.675, 0.7)) # Map high GC (>70\%) to (0.675, 0.7]
    ),
    mask = repeats,
    iterator = 200
)

}
\seealso{
\code{\link{gcanvas.sample}}, \code{\link{gcanvas.save}},
         \code{\link{gcanvas.load}}, \code{\link{gcanvas.bin_map}}
}
